<template>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1 class="main-title">Tag Lead</h1>
            <p class="subtitle">Search or create leads</p>
        </div>

        <!-- Search View -->
        <template if:true={showSearch}>
            <div class="card search-card">
                <div class="card-header">
                    <lightning-icon icon-name="utility:search" size="small" class="header-icon"></lightning-icon>
                    <h2 class="card-title">Search Lead</h2>
                </div>
                
                <div class="search-box">
                    <input 
                        type="text"
                        class="custom-input"
                        placeholder="Search by name or phone"
                        value={searchKeyword}
                        oninput={handleSearchInput}
                        onkeypress={handleSearchKeyPress}
                    />
                    <button 
                        class="search-button"
                        onclick={handleSearchClick}
                        disabled={isLoading}>
                        Search
                    </button>
                </div>

                <!-- Spinner -->
                <template if:true={isLoading}>
                    <div class="spinner-container">
                        <lightning-spinner size="small" alternative-text="Searching..."></lightning-spinner>
                    </div>
                </template>

                <!-- Lead Results -->
                <template if:true={showLeadResults}>
                    <div class="result-container">
                        <template for:each={leads} for:item="lead">
                            <div 
                                key={lead.Id}
                                data-id={lead.Id}
                                class={lead.selectedClass}
                                onclick={selectLead}>
                                
                                <div class="lead-info">
                                    <div class="lead-name">{lead.Name}</div>
                                    <div class="lead-email">
                                        <lightning-icon icon-name="utility:email" size="xx-small"></lightning-icon>
                                        {lead.Email__c}
                                    </div>
                                </div>
                                
                                <template if:true={lead.selectedClass}>
                                    <lightning-icon icon-name="utility:check" size="small" class="check-icon"></lightning-icon>
                                </template>
                            </div>
                        </template>
                    </div>

                    <!-- Tag Button - Shows after lead selection -->
                    <template if:true={showTagButton}>
                        <div class="tag-button-container">
                            <button 
                                class="custom-button primary"
                                onclick={handleTagLead}
                                disabled={isLoading}>
                                {tagButtonLabel}
                            </button>
                        </div>
                    </template>
                </template>
            </div>
        </template>

        <!-- Not Found Message -->
        <template if:true={showNotFound}>
            <div class="card not-found-card">
                <div class="not-found-content">
                    <lightning-icon icon-name="utility:info" size="medium" class="info-icon"></lightning-icon>
                    <h3 class="not-found-title">No leads found</h3>
                    <p class="not-found-message">
                        We couldn't find any leads matching "{searchKeyword}"
                    </p>
                    <button 
                        class="custom-button primary"
                        onclick={handleCreateNew}>
                        Create New Lead
                    </button>
                </div>
            </div>
        </template>

        <!-- Create Form -->
        <template if:true={showCreateForm}>
            <div class="card create-card">
                <div class="card-header">
                    <lightning-icon icon-name="utility:adduser" size="small" class="header-icon"></lightning-icon>
                    <h2 class="card-title">Create New Lead</h2>
                </div>

                <div class="form-container">
                    <div class="form-field">
                        <label class="form-label">
                            Name <span class="required-asterisk">*</span>
                        </label>
                        <input 
                            type="text"
                            class="custom-input"
                            placeholder="Enter full name"
                            value={formData.name}
                            onchange={handleNameChange}
                        />
                    </div>

                    <div class="form-field">
                        <label class="form-label">
                            Course <span class="required-asterisk">*</span>
                        </label>
                        <select 
                            class="custom-input"
                            value={formData.course}
                            onchange={handleCourseChange}>
                            <option value="">-- Select Course --</option>
                            <template for:each={courseOptions} for:item="option">
                                <option key={option.value} value={option.value}>
                                    {option.label}
                                </option>
                            </template>
                        </select>
                    </div>

                    <div class="form-field">
                        <label class="form-label">Email</label>
                        <input 
                            type="email"
                            class="custom-input"
                            placeholder="Enter email address"
                            value={formData.email}
                            onchange={handleEmailChange}
                        />
                    </div>

                    <div class="action-buttons">
                        <button 
                            class="custom-button primary"
                            onclick={handleSubmit}
                            disabled={isLoading}>
                            {submitButtonLabel}
                        </button>
                        <button 
                            class="custom-button secondary"
                            onclick={handleCancel}
                            disabled={isLoading}>
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </template>
    </div>
</template>