<template>
  <div class="wrap">
    <div class="toolbar">
      <div>
        <template if:true={queueRunning}>
          <span>Auto dial running</span>
          <template if:true={isWaiting}>
            <span> â€¢ Next call in 
              <template if:true={decisionCountdown}>{decisionCountdown}s</template>
              <template if:false={decisionCountdown}>{countdown}s</template>
            </span>
          </template>
        </template>
      </div>

      <div>
        <!-- LEAD COUNTERS -->
        <div class="lead-stats slds-box slds-m-around_small slds-theme_shade">
          <div class="slds-grid slds-wrap">
            <div class="slds-col slds-size_1-of-3">
              <b>Total Leads:</b> {totalLeads}
            </div>
            <div class="slds-col slds-size_1-of-3">
              <b>Called:</b> {callsCompleted}
            </div>
            <div class="slds-col slds-size_1-of-3">
              <b>Remaining:</b> {remainingLeads}
            </div>
          </div>
        </div>
      </div>

      <div class="actions">
        <button class="btn" onclick={handleStart} disabled={disableStart}>Start</button>
        <button class="btn ghost" onclick={handlePause} disabled={disablePause}>Pause</button>
        <button class="btn success" onclick={handleResume} disabled={disableResume}>Resume</button>
        <button class="btn ghost" onclick={handleEnd} disabled={disableEnd}>End</button>
      </div>
    </div>

    <div class="table-scroller">
      <table class="matrix">
        <thead>
          <tr>
            <th>#</th>
            <th>Lead Name</th>
            <th>Phone Number</th>
            <th>Primary Tag</th>
            <th>Bucket</th>
            <th>Level</th>  
            <th>Course</th>          
            <th>City</th>
          </tr>
        </thead>
        <tbody>
          <template if:true={hasLeads}>
            <template for:each={leads} for:item="lead">
              <tr key={lead.id}>
                <td>{lead.rowNumber}</td>
                <td>{lead.name}</td>
                <td>{lead.phone}</td>
                <td>{lead.primaryTag}</td>
                <td>{lead.source}</td>
                <td>{lead.stage}</td>
                <td>{lead.course}</td>
                <td>{lead.city}</td>
              </tr>
            </template>
          </template>

          <template if:false={hasLeads}>
            <tr>
              <td colspan="5" class="no-data">No leads to display.</td>
            </tr>
          </template>
        </tbody>
      </table>
    </div>

    <!-- MODAL START -->
    <template if:true={showModal}>
      <div class="modal-overlay slds-backdrop slds-backdrop_open"></div>

      <section class="slds-modal slds-fade-in-open" style="display:block; background:transparent;">
        <div class="slds-modal__container">
          <header class="slds-modal__header">
            <button class="slds-button slds-button_icon slds-modal__close" onclick={closeModal}>
              <lightning-icon icon-name="utility:close" size="small"></lightning-icon>
            </button>
            <h2 class="slds-text-heading_medium">Calling</h2>
          </header>

          <div class="slds-modal__content">
            <c-runo-allocation-calls
              record-id={currentLeadId}
              is-call-log={currentIsCallLog}
              oncallcomplete={handleCallComplete}>
            </c-runo-allocation-calls>
          </div>
        </div>
      </section>
    </template>
    <!-- MODAL END -->
  </div>
</template>