<template>
    <div class="container">

        <!-- Header -->
        <div class="header">
            <h2 class="title">Lead Merge</h2>
            <p class="subtitle">Search and select leads to merge with current record</p>
        </div>

        <!-- Search Bar -->
        <div class="search-container">
            <div class="search-box">
                <svg class="search-icon" viewBox="0 0 20 20" fill="none">
                    <path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16zM16.5 16.5l-3-3" stroke="currentColor"
                        stroke-width="1.5" stroke-linecap="round" />
                </svg>
                <input type="text" value={searchKey} oninput={handleChange}
                    placeholder="Search by name, email, phone or candidate ID" class="search-input" />
            </div>
            <button onclick={handleSearch} class="btn-primary">
                Search
            </button>
        </div>

        <!-- Selected Leads -->
        <template if:true={hasSelectedLeads}>
            <div class="section">
                <div class="section-header">
                    <div class="section-header-left">
                        <h3 class="section-title">Selected Leads</h3>
                        <span class="count-badge">{selectedLeadsCount}</span>
                    </div>
                </div>

                <div class="cards-grid">
                    <template for:each={selectedLeads} for:item="lead">
                        <div key={lead.Id} class="card selected-card">
                            <div class="card-content">
                                <div class="card-header-row">
                                    <div class="avatar">
                                        <svg viewBox="0 0 24 24" fill="none">
                                            <path
                                                d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2M12 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"
                                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                                        </svg>
                                    </div>
                                    <div class="card-info">
                                        <h4 class="card-name">{lead.Name}</h4>
                                        <div class="card-meta">
                                            <span class="meta-item">
                                                <svg viewBox="0 0 20 20" fill="currentColor">
                                                    <path
                                                        d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
                                                    <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
                                                </svg>
                                                {lead.Email__c}
                                            </span>
                                            <span class="meta-item">
                                                <svg viewBox="0 0 20 20" fill="currentColor">
                                                    <path fill-rule="evenodd"
                                                        d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
                                                        clip-rule="evenodd" />
                                                </svg>
                                                {lead.Course__c}
                                            </span>
                                            <span class="meta-item">
                                                <svg viewBox="0 0 20 20" fill="currentColor">
                                                    <path fill-rule="evenodd"
                                                        d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
                                                        clip-rule="evenodd" />
                                                </svg>
                                                {lead.ownerName}
                                            </span>
                                        </div>
                                    </div>
                                    <button class="btn-remove" data-id={lead.Id} onclick={handleRemoveLead}>
                                        <svg viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd"
                                                d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                                                clip-rule="evenodd" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- Merge Comments (Only needed for GM merge) -->
                <template if:true={showComments}>
                    <div class="comments-section">
                        <label class="field-label">Merge Comments</label>
                        <lightning-textarea class="comment-input-lwc" label="Merge Comments" variant="label-hidden"
                            placeholder="Enter comments (Required if you are the Manager merging these leads)"
                            value={mergeComments} onchange={handleCommentChange}></lightning-textarea>
                    </div>
                </template>

                <!-- Merge Button -->
                <div class="action-bar">
                    <button onclick={handleMerge} class="btn-merge">
                        <svg viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z"
                                clip-rule="evenodd" />
                        </svg>
                        Merge {selectedLeadsCount} Lead{selectedLeadsCountPlural}
                    </button>
                </div>
            </div>
        </template>

        <!-- Search Results -->
        <template if:true={leads.length}>
            <div class="section">
                <div class="section-header">
                    <div class="section-header-left">
                        <h3 class="section-title">Search Results</h3>
                        <span class="count-badge-secondary">{leads.length}</span>
                    </div>
                </div>

                <div class="cards-grid">
                    <template for:each={leads} for:item="lead">
                        <div key={lead.Id} data-id={lead.Id} onclick={handleSelectLead} class="card result-card">
                            <div class="card-content">
                                <div class="card-header-row">
                                    <div class="avatar">
                                        <svg viewBox="0 0 24 24" fill="none">
                                            <path
                                                d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2M12 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"
                                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                                        </svg>
                                    </div>
                                    <div class="card-info">
                                        <h4 class="card-name">{lead.Name}</h4>
                                        <div class="card-meta">
                                            <span class="meta-item">
                                                <svg viewBox="0 0 20 20" fill="currentColor">
                                                    <path
                                                        d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
                                                    <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
                                                </svg>
                                                {lead.Email__c}
                                            </span>
                                            <span class="meta-item">
                                                <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18">
                                                    <path
                                                        d="M6 4h12a2 2 0 012 2v12a1 1 0 01-1.447.894L12 16l-6.553 2.894A1 1 0 014 18V6a2 2 0 012-2z" />
                                                </svg>
                                                {lead.Course__c}
                                            </span>
                                            <span class="meta-item">
                                                <svg viewBox="0 0 20 20" fill="currentColor">
                                                    <path fill-rule="evenodd"
                                                        d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
                                                        clip-rule="evenodd" />
                                                </svg>
                                                {lead.ownerName}
                                            </span>
                                        </div>
                                    </div>
                                    <div class="add-indicator">
                                        <svg viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd"
                                                d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z"
                                                clip-rule="evenodd" />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </template>

        <!-- Empty State -->
        <template if:false={hasAnyContent}>
            <div class="empty-state">
                <div class="empty-icon">
                    <svg viewBox="0 0 24 24" fill="none">
                        <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2" />
                        <path d="m21 21-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                </div>
                <h3 class="empty-title">No leads found</h3>
                <p class="empty-text">Start by searching for leads to merge</p>
            </div>
        </template>

    </div>
</template>